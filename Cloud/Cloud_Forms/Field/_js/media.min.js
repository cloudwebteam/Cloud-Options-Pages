function htmlEntities(e){return String(e).replace(/</g,"&lt;").replace(/>/g,"&gt;")}CloudField.on("init",function(e,t){var n=".type-media",r=e(n,t).add(t.filter(n));r.each(function(){if(e(this).find(".clone").size()>0)return;var t=e(this).find("input.url_field"),n=e(this).find(".image"),r=n.find("img");e(this).find(".remove-media").on("click",function(){t.val("");r.slideUp("fast",function(){e(this).addClass("hidden");e(this).attr("src","")})});e(this).find(".upload_button").click(function(t){var n=e(this),r=n.parents(".type-media").first(),i=!0,s=wp.media.editor.send.attachment,i=!0,o=wp.media.editor.send.attachment,u=r.find("input.url_field"),a=r.find(".image"),f=a.find("img"),l=u.data("to_insert");e(".add_media").on("click",function(){i=!1});wp.media.editor.send.attachment=function(t,n){if(!i)return s.apply(this,[t,n]);if(n.type==="image")var r=n.sizes[t.size].url,o=r;else var r=n.url,o=n.icon;var a={media:n.id};u.val(JSON.stringify(a));if(l==="ID")u.val(n.id);else if(l==="url")u.val(r);else if(l==="image"){var c='<img src="'+r+'" title="'+n.title+'" class="media" />';u.val(htmlEntities(c))}f.slideUp("fast",function(){e(this).removeClass("hidden");e(this).attr("src",o).attr("title",n.title);e(this).slideDown("fast")})};wp.media.editor.open(n);return!1})})});