CloudField.on("init",function(e,t){function s(e){var t=e.split("/"),n=cloud.cloud_url.split("/"),r="",s="";for(i in t)if(!r&&t[i])for(j in n)if(n[j]&&n[j]===t[i]){r=i;s=j}var e=t.slice(r).join("/"),o=n.slice(0,s).join("/");return o+"/"+e}var n=".type-file",r=e(n,t).add(t.filter(n));r.each(function(){if(e(this).find(".clone").size()>0)return;var t=e(this),n=t.find(".uploader"),r=t.find(".inner-container"),i=n.data("uploader"),o=t.find(".remove-file"),u=i.isWP?cloud.wp_ajax:cloud.cloud_ajax,a=t.find('input[name="'+i.name+'"]'),f=t.find(".display"),l=t.find(".upload-button");n.fineUploader({debug:!1,button:l,dragAndDrop:{disableDefaultDropzone:!0},mode:"basic",request:{params:{action:"cloud_upload_file",allowedExtensions:i.allowedExtensions,uploadDir:i.uploadDir,wpMedia:i.wpMedia},paramsInBody:!0,endpoint:u,autoUpload:!1},failedUploadTextDisplay:{mode:"custom",maxChars:40,responseProperty:"error",enableTooltip:!0}}).on("error",function(e,t,n,r){}).on("complete",function(e,t,n,o){if(o.success){var u=i.uploadDir+"/"+o.uploadName,l=s(u);console.log(l);r.addClass("has-value");f.find("img").attr("src",l);f.find(".name").html(n);f.find(".upload-name").html(o.uploadName);a.val(u)}else console.log(n,o)});o.on("click",function(){r.removeClass("has-value");f.find("img").attr("src","");f.find(".name").html("");var t=f.find(".upload-name").html();f.find(".upload-name").html("");a.val("");e.ajax({type:"post",dataType:"json",url:u,data:{action:"cloud_delete_upload",fileName:t,uploadDir:i.uploadDir},success:function(e){console.log(e)}})})})});