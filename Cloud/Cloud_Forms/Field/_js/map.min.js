CloudField.on("init",function(e,t){var e=jQuery,n=".field.type-map",r=e(n,t).add(t.filter(n)),i={zoom:9,markerZoom:15,mapType:"ROADMAP",latitude:35.469618,longitude:-97.514648};r.each(function(){function c(){function y(n){if(l==u.getZoom()){e(".place-marker",t).live("click.gmap",function(){a=g(n);f.close();e(".place-marker",t).die("click.gmap");f=!1});if(f){f.close();e(".place-marker",t).die("click.gmap");f=!1}else{f=new google.maps.InfoWindow({content:'<a class="place-marker" href="#marker">Place marker</a>',position:n,map:u});google.maps.event.addListener(f,"closeclick",function(){e(".place-marker",t).die("click.gmap");f=!1})}}}var c=n.val(),h=r.val(),d=s.val(),v={};c&&(v.latitude=c);h&&(v.longitude=h);console.log(d);if(!d||parseInt(d)<6||parseInt(d)>20)d=i.markerZoom;console.log(d,i.markerZoom);var v=e.extend(i,v),m={zoom:v.zoom,mapTypeId:google.maps.MapTypeId[v.mapType],center:new google.maps.LatLng(v.latitude,v.longitude)};u=new google.maps.Map(o[0],m);var g=function(e,t){var n=typeof e=="object"?e:new google.maps.LatLng(e,t);if(a)a.setPosition(n);else{a=new google.maps.Marker({position:n,map:u,draggable:!0,title:"Latitude: "+n.lat()+", "+"Longitude: "+n.lng()});google.maps.event.addListener(a,"click",function(){f=new google.maps.InfoWindow({content:"<b>Latitude:</b> "+n.lat()+"<br />"+"<b>Longitude:</b> "+n.lng(),position:n,map:u})});google.maps.event.clearListeners(u,"click");google.maps.event.addListener(u,"zoom_changed",function(){s.val(u.getZoom())})}u.setCenter(n);p();return a};if(c&&h){a=g(c,h);u.setZoom(d)}google.maps.event.addListener(u,"click",function(e){a||setTimeout(function(){y(e.latLng)},600)});n.add(r).on("change",function(){u.setZoom(i.markerZoom);g(n.val(),r.val())})}function p(){var e=a.getPosition();n.val(e.lat());r.val(e.lng())}var t=e(this),n=e(this).find("input.latitude"),r=e(this).find("input.longitude"),s=e(this).find("input.zoom"),o=e(this).find(".map-container");o.on("mousedown",function(e){e.stopPropagation()});var u=!1,a=!1,f=!1,l,h=setInterval(function(){if(o.is(":visible")){clearInterval(h);c()}},100),d=function(e,t){n.val(e);r.val(t).change()};o.data("map",{updateMarker:d})})});