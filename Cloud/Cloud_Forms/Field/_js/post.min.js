CloudField.on("init",function(e,t){var n=".type-post",r=e(n,t).add(t.filter(n)),i=e("#wp_link_popup #wp-link-dialog"),s=i.find("#_ajax_linking_nonce").val(),o=i.find(".link-search-field"),u=i.find(".none-found"),a=i.find(".loading img");r.each(function(){var t=e(this),n=t.find(".select-post"),r=t.find(".target-field"),f=r.data("to_get"),l=r.data("image_size"),c=t.find(".popup > div"),h=t.find(".remove-post"),p=t.find(".post-title"),d=t.find(".post_type"),v={list:i.find(".query-results ul"),init:function(t){this.list.find("li a").each(function(){e(this).click(function(t){t.preventDefault();var n={post:e(this).data("post_id")};r.val(JSON.stringify(n));r.siblings(".preview").html('<div class="inner">'+e(this).parents("li").find(".to_insert").html()+"</div>");p.text(e(this).find(".title").text());d.text(e(this).find(".type").text());h.removeClass("hidden");e.fancybox.close()})})}},m={get_list:function(t){if(t){var n={action:"options-page-link-popup",search:t,_ajax_linking_nonce:s,to_get:f,image_size:l};a.show();e.post(cloud.wp_ajax,n,function(e){if(e){u.hide();v.list.html(e).fadeIn("fast");v.init()}else{v.list.hide();u.fadeIn("fast")}a.hide()},"html")}else v.list.html("")},get_initial_list:function(){var t={action:"options-page-link-popup",search:"",_ajax_linking_nonce:s,to_get:f,image_size:l};v.list.hide();e.post(cloud.wp_ajax,t,function(e){if(e){u.hide();v.list.html(e).slideDown("fast");v.init()}else{v.list.hide();u.fadeIn("fast")}a.hide()},"html")}};n.click(function(t){t.preventDefault();e.fancybox.open({href:"#"+i.attr("id"),title:"Get Existing Content Info ( "+f+" ) ",beforeShow:m.get_initial_list(),afterClose:function(){o.val("");v.list.html("");r.removeClass("target")},height:400,width:300,autoSize:!1})});h.click(function(e){r.val("");p.text("None Selected");d.text("Post");h.addClass("hidden")});o.keyup(function(){m.get_list(e(this).val())})})});